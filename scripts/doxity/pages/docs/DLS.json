{"fileName":"/contracts/DLS.sol","name":"DLS","abi":[{"constant":false,"inputs":[{"name":"pubKey","type":"address"}],"name":"deregisterPublisher","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"sellerDomain","type":"string"},{"name":"sellerId","type":"string"},{"name":"sellerRel","type":"uint8"}],"name":"removeSeller","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"publishers","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"sellerDomain","type":"string"},{"name":"sellerId","type":"string"},{"name":"sellerRel","type":"uint8"},{"name":"sellerTagId","type":"string"}],"name":"addSeller","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"pubKey","type":"address"},{"name":"sellerDomain","type":"string"},{"name":"sellerId","type":"string"},{"name":"sellerRel","type":"uint8"}],"name":"isSellerForPublisher","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"domain","type":"bytes32"}],"name":"isRegisteredPublisherDomain","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"pubKey","type":"address"}],"name":"isRegisteredPublisher","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"bytes32"}],"name":"sellers","outputs":[{"name":"domain","type":"string"},{"name":"id","type":"string"},{"name":"rel","type":"uint8"},{"name":"tagId","type":"string"},{"name":"hash","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"changeOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"hash","type":"bytes32"}],"name":"addSellerHash","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"publisherDomain","type":"string"}],"name":"getPublisherFromDomain","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"domains","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"domain","type":"bytes32"},{"name":"pubKey","type":"address"}],"name":"registerPublisher","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"domain","type":"bytes32"},{"indexed":true,"name":"id","type":"address"}],"name":"_PublisherRegistered","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"domain","type":"bytes32"},{"indexed":true,"name":"id","type":"address"}],"name":"_PublisherDeregistered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"publisher","type":"address"},{"indexed":true,"name":"sellerHash","type":"bytes32"}],"name":"_SellerAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"publisher","type":"address"},{"indexed":true,"name":"sellerHash","type":"bytes32"}],"name":"_SellerRemoved","type":"event"}],"source":"pragma solidity ^0.4.4;\n\n\ncontract DLS {\n  /*\n   * A container for publisher-reseller relationship data.\n   * This is the equivalent of a single row in ads.txt\n   */\n  struct Seller {\n    string domain; // SSP/Exchange Domain\n    string id; // SellerAccountID\n    Relationship rel; // PaymentsType\n    string tagId; // TAGID - Trustworthy Accountability Group ID\n    bytes32 hash; // hash of: (domain, id, rel)\n  }\n\n  /*\n   * The various types of relationships\n   * (can be extended along with ads.txt spec)\n   */\n  enum Relationship {\n    Null,\n    Direct,\n    Reseller\n  }\n\n  /**\n   * @notice a mapping of domains to publisher public keys\n   *\n   * @example\n   * \"nytimes.com\" -> \"0x123...abc\"\n   */\n  mapping (bytes32 => address) public publishers;\n\n  /**\n   * @notice a mapping of publisher public keys to domains\n   *\n   * @example\n   * \"0x123...abc\" -> \"nytimes.com\"\n   */\n  mapping (address => bytes32) public domains;\n\n   /**\n    * @notice a mapping of publsher domains to\n    * their authorized sellers and their data.\n    *\n    * @example example\n    * sellers[sha3(domain)][sellerHash] -> Seller\n    *\n    * Publishers ads.txt\n    * Row 1 - reseller1.com, 1293sdf, direct, tagId, hash\n    * Row 2 - reseller2.com, 1293sdf, reseller, tagId, hash\n    */\n  mapping (bytes32 => mapping (bytes32 => Seller)) public sellers;\n\n  /**\n   * @notice The owner of this contract.\n   */\n  address public owner;\n\n  /**\n   * Events, when triggered, record logs in the blockchain.\n   * Clients can listen on specific events to fetch data.\n   */\n  event _PublisherRegistered(bytes32 domain, address indexed id);\n  event _PublisherDeregistered(bytes32 domain, address indexed id);\n  event _SellerAdded(address indexed publisher, bytes32 indexed sellerHash);\n  event _SellerRemoved(address indexed publisher, bytes32 indexed sellerHash);\n\n  /**\n   * @notice modifier which limits execution\n   * of the function to the owner.\n   */\n  modifier only_owner () {\n    if (msg.sender != owner) {\n      revert();\n    }\n\n    // continue with code execution\n    _;\n  }\n\n  /*\n   * @notice The constructor function,\n   * called only once when this contract is initially deployed.\n   */\n  function DLS() {\n    owner = msg.sender;\n  }\n\n  /**\n   * @notice Change owner of contract.\n   * @param newOwner new owner address\n   */\n  function changeOwner(address newOwner) only_owner external {\n    owner =  newOwner;\n  }\n\n  /**\n   * @notice Register new publisher.\n   * Only the owner of the contract can register new publishers.\n   * Publisher public key must not already exist in order to\n   * be added or modified.\n   * @param domain pubisher domain\n   * @param pubKey pubisher public key\n   */\n  function registerPublisher(bytes32 domain, address pubKey) only_owner external {\n    require(domains[pubKey] == \"\");\n    publishers[sha3(domain)] = pubKey;\n    domains[pubKey] = domain;\n    _PublisherRegistered(domain, pubKey);\n  }\n\n  /**\n   * @notice Deregister existing publisher.\n   * Only contract owner is allowed to deregister.\n   * @param pubKey pubisher public key\n   */\n  function deregisterPublisher(address pubKey) only_owner external {\n    require(publishers[sha3(domains[pubKey])] != address(0));\n    // order matters here, delete pub from map first.\n    delete publishers[sha3(domains[pubKey])];\n    delete domains[pubKey];\n    _PublisherDeregistered(domains[pubKey], pubKey);\n  }\n\n  /**\n   * @notice Check if publisher is registered.\n   * @param pubKey pubisher public key\n   * @return bool\n   */\n  function isRegisteredPublisher(address pubKey) external constant returns (bool) {\n    if (domains[pubKey] != \"\") return true;\n    return false;\n  }\n\n  /**\n   * @notice Check if publisher is registered by domain\n   * @param domain pubisher domain\n   * @return bool\n   */\n  function isRegisteredPublisherDomain(bytes32 domain) external constant returns (bool) {\n    if (publishers[sha3(domain)] != address(0)) return true;\n    return false;\n  }\n\n  /**\n   * @notice add seller for publisher.\n   * Only allowed once publisher is registered.\n   * @param sellerDomain domain of seller/exchange\n   * @param sellerId ID of seller\n   * @param sellerRel Relationship of seller. (Direct: 0, Reseller: 1)\n   * @param sellerTagId Trustworthy Accountability Group (TAG) ID\n   */\n  function addSeller(\n    string sellerDomain,\n    string sellerId,\n    Relationship sellerRel,\n    string sellerTagId\n  ) external {\n    require(sha3(domains[msg.sender]) != sha3(\"\"));\n    bytes32 hash = sha3(sellerDomain, sellerId, sellerRel);\n    sellers[sha3(domains[msg.sender])][hash] = Seller(sellerDomain, sellerId, Relationship(sellerRel), sellerTagId, hash);\n    _SellerAdded(msg.sender, hash);\n  }\n\n  /**\n   * @notice Allow publisher to add a seller by hash (instead of plain text attributes)\n   * @param hash sha3 hash of seller information\n   */\n  function addSellerHash(bytes32 hash) external {\n    require(sha3(domains[msg.sender]) != sha3(\"\"));\n    sellers[sha3(domains[msg.sender])][hash] = Seller(\"\", \"\", Relationship.Null, \"\", hash);\n    _SellerAdded(msg.sender, hash);\n  }\n\n  /**\n   * @notice Remove seller from publisher.\n   * @param sellerDomain domain of seller\n   * @param sellerId ID of seller\n   * @param sellerRel Relationship of seller. (Direct: 0, Reseller: 1)\n   */\n  function removeSeller(\n    string sellerDomain,\n    string sellerId,\n    Relationship sellerRel\n  ) external {\n    // Check that this ethereum address is a registered publisher.\n    require(sha3(domains[msg.sender]) != sha3(\"\"));\n    bytes32 hash = sha3(sellerDomain, sellerId, sellerRel);\n    delete sellers[sha3(domains[msg.sender])][hash];\n    _SellerRemoved(msg.sender, hash);\n  }\n\n  /**\n    * @notice Get publisher public key from domain name\n    * @param publisherDomain domain of publisher\n    * @return publisher public key\n    */\n  function getPublisherFromDomain(\n    string publisherDomain\n  ) public constant returns (address) {\n    return publishers[sha3(publisherDomain)];\n  }\n\n  /**\n   * @notice Return true if is seller for publisher\n   * @param pubKey publisher public key\n   * @param sellerDomain domain of seller\n   * @param sellerId ID of seller\n   * @param sellerRel Relationship of seller. (Direct: 0, Reseller: 1)\n   * @return boolean\n   */\n  function isSellerForPublisher(\n    address pubKey,\n    string sellerDomain,\n    string sellerId,\n    Relationship sellerRel\n  ) external constant returns (bool) {\n    bytes32 hash = sha3(sellerDomain, sellerId, sellerRel);\n    Seller storage seller = sellers[sha3(domains[pubKey])][hash];\n\n    if (sha3(seller.id) != sha3(\"\")) {\n      if (seller.rel == sellerRel) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n","abiDocs":[{"constant":false,"inputs":[{"name":"pubKey","type":"address","description":"pubisher public key"}],"name":"deregisterPublisher","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"Deregister existing publisher. Only contract owner is allowed to deregister.","signature":"deregisterPublisher(address)","signatureHash":"12d41194"},{"constant":false,"inputs":[{"name":"sellerDomain","type":"string","description":"domain of seller"},{"name":"sellerId","type":"string","description":"ID of seller"},{"name":"sellerRel","type":"uint8","description":"Relationship of seller. (Direct: 0, Reseller: 1)"}],"name":"removeSeller","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"Remove seller from publisher.","signature":"removeSeller(string,string,uint8)","signatureHash":"336a53be"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"publishers","payable":false,"stateMutability":"view","type":"function","signature":"publishers(bytes32)","signatureHash":"410d4fdd"},{"constant":false,"inputs":[{"name":"sellerDomain","type":"string","description":"domain of seller/exchange"},{"name":"sellerId","type":"string","description":"ID of seller"},{"name":"sellerRel","type":"uint8","description":"Relationship of seller. (Direct: 0, Reseller: 1)"},{"name":"sellerTagId","type":"string","description":"Trustworthy Accountability Group (TAG) ID"}],"name":"addSeller","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"add seller for publisher. Only allowed once publisher is registered.","signature":"addSeller(string,string,uint8,string)","signatureHash":"44036a7c"},{"constant":true,"inputs":[{"name":"pubKey","type":"address","description":"publisher public key"},{"name":"sellerDomain","type":"string","description":"domain of seller"},{"name":"sellerId","type":"string","description":"ID of seller"},{"name":"sellerRel","type":"uint8","description":"Relationship of seller. (Direct: 0, Reseller: 1)"}],"name":"isSellerForPublisher","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function","return":"boolean","notice":"Return true if is seller for publisher","signature":"isSellerForPublisher(address,string,string,uint8)","signatureHash":"4e7fabbf"},{"constant":true,"inputs":[{"name":"domain","type":"bytes32","description":"pubisher domain"}],"name":"isRegisteredPublisherDomain","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function","return":"bool","notice":"Check if publisher is registered by domain","signature":"isRegisteredPublisherDomain(bytes32)","signatureHash":"61e2d43d"},{"constant":true,"inputs":[],"name":"owner","payable":false,"stateMutability":"view","type":"function","signature":"owner()","signatureHash":"8da5cb5b"},{"constant":true,"inputs":[{"name":"pubKey","type":"address","description":"pubisher public key"}],"name":"isRegisteredPublisher","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function","return":"bool","notice":"Check if publisher is registered.","signature":"isRegisteredPublisher(address)","signatureHash":"9fb91410"},{"constant":true,"inputs":[{"name":"","type":"bytes32"},{"name":"","type":"bytes32"}],"name":"sellers","payable":false,"stateMutability":"view","type":"function","signature":"sellers(bytes32,bytes32)","signatureHash":"a08508fd"},{"constant":false,"inputs":[{"name":"newOwner","type":"address","description":"new owner address"}],"name":"changeOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"Change owner of contract.","signature":"changeOwner(address)","signatureHash":"a6f9dae1"},{"constant":false,"inputs":[{"name":"hash","type":"bytes32","description":"sha3 hash of seller information"}],"name":"addSellerHash","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"Allow publisher to add a seller by hash (instead of plain text attributes)","signature":"addSellerHash(bytes32)","signatureHash":"cea228d4"},{"constant":true,"inputs":[{"name":"publisherDomain","type":"string","description":"domain of publisher"}],"name":"getPublisherFromDomain","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","return":"publisher public key","notice":"Get publisher public key from domain name","signature":"getPublisherFromDomain(string)","signatureHash":"e267c06e"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"domains","payable":false,"stateMutability":"view","type":"function","signature":"domains(address)","signatureHash":"e2ffea6e"},{"constant":false,"inputs":[{"name":"domain","type":"bytes32","description":"pubisher domain"},{"name":"pubKey","type":"address","description":"pubisher public key"}],"name":"registerPublisher","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","notice":"Register new publisher. Only the owner of the contract can register new publishers. Publisher public key must not already exist in order to be added or modified.","signature":"registerPublisher(bytes32,address)","signatureHash":"ee83fba2"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"domain","type":"bytes32"},{"indexed":true,"name":"id","type":"address"}],"name":"_PublisherRegistered","type":"event","signature":"_PublisherRegistered(bytes32,address)","signatureHash":"e931c010"},{"anonymous":false,"inputs":[{"indexed":false,"name":"domain","type":"bytes32"},{"indexed":true,"name":"id","type":"address"}],"name":"_PublisherDeregistered","type":"event","signature":"_PublisherDeregistered(bytes32,address)","signatureHash":"f989fc40"},{"anonymous":false,"inputs":[{"indexed":true,"name":"publisher","type":"address"},{"indexed":true,"name":"sellerHash","type":"bytes32"}],"name":"_SellerAdded","type":"event","signature":"_SellerAdded(address,bytes32)","signatureHash":"15131c27"},{"anonymous":false,"inputs":[{"indexed":true,"name":"publisher","type":"address"},{"indexed":true,"name":"sellerHash","type":"bytes32"}],"name":"_SellerRemoved","type":"event","signature":"_SellerRemoved(address,bytes32)","signatureHash":"7b40cc7b"}]}
